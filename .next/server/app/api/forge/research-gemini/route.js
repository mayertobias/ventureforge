(()=>{var a={};a.id=99,a.ids=[99],a.modules={261:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/app-paths")},3295:a=>{"use strict";a.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11723:a=>{"use strict";a.exports=require("querystring")},12412:a=>{"use strict";a.exports=require("assert")},12909:(a,b,c)=>{"use strict";c.d(b,{N:()=>f});var d=c(36344),e=c(94747);let f={providers:[(0,d.A)({clientId:process.env.GOOGLE_CLIENT_ID,clientSecret:process.env.GOOGLE_CLIENT_SECRET})],callbacks:{async signIn({user:a,account:b,profile:c}){if(b?.provider==="google")try{await e.z.user.findUnique({where:{email:a.email}})||await e.z.user.create({data:{email:a.email,name:a.name,image:a.image,credits:100}})}catch(a){return console.error("Error creating user:",a),!1}return!0},async session({session:a,token:b}){if(a?.user?.email){let b=await e.z.user.findUnique({where:{email:a.user.email}});b&&a.user&&(a.user.id=b.id)}return a},jwt:async({user:a,token:b})=>b},session:{strategy:"jwt"},secret:process.env.NEXTAUTH_SECRET}},28354:a=>{"use strict";a.exports=require("util")},29294:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-async-storage.external.js")},39394:(a,b,c)=>{"use strict";c.r(b),c.d(b,{handler:()=>aA,patchFetch:()=>az,routeModule:()=>av,serverHooks:()=>ay,workAsyncStorage:()=>aw,workUnitAsyncStorage:()=>ax});var d,e,f,g,h,i,j,k,l,m,n,o,p={};c.r(p),c.d(p,{POST:()=>au});var q=c(96559),r=c(48088),s=c(37719),t=c(26191),u=c(81289),v=c(261),w=c(92603),x=c(39893),y=c(14823),z=c(47220),A=c(66946),B=c(47912),C=c(99786),D=c(46143),E=c(86439),F=c(43365),G=c(32190),H=c(19854),I=c(12909),J=c(94747);!function(a){a.STRING="string",a.NUMBER="number",a.INTEGER="integer",a.BOOLEAN="boolean",a.ARRAY="array",a.OBJECT="object"}(d||(d={})),function(a){a.LANGUAGE_UNSPECIFIED="language_unspecified",a.PYTHON="python"}(e||(e={})),function(a){a.OUTCOME_UNSPECIFIED="outcome_unspecified",a.OUTCOME_OK="outcome_ok",a.OUTCOME_FAILED="outcome_failed",a.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded"}(f||(f={}));let K=["user","model","function","system"];!function(a){a.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",a.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",a.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",a.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",a.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",a.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY"}(g||(g={})),function(a){a.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",a.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",a.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",a.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",a.BLOCK_NONE="BLOCK_NONE"}(h||(h={})),function(a){a.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",a.NEGLIGIBLE="NEGLIGIBLE",a.LOW="LOW",a.MEDIUM="MEDIUM",a.HIGH="HIGH"}(i||(i={})),function(a){a.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",a.SAFETY="SAFETY",a.OTHER="OTHER"}(j||(j={})),function(a){a.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",a.STOP="STOP",a.MAX_TOKENS="MAX_TOKENS",a.SAFETY="SAFETY",a.RECITATION="RECITATION",a.LANGUAGE="LANGUAGE",a.BLOCKLIST="BLOCKLIST",a.PROHIBITED_CONTENT="PROHIBITED_CONTENT",a.SPII="SPII",a.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",a.OTHER="OTHER"}(k||(k={})),function(a){a.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",a.RETRIEVAL_QUERY="RETRIEVAL_QUERY",a.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",a.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",a.CLASSIFICATION="CLASSIFICATION",a.CLUSTERING="CLUSTERING"}(l||(l={})),function(a){a.MODE_UNSPECIFIED="MODE_UNSPECIFIED",a.AUTO="AUTO",a.ANY="ANY",a.NONE="NONE"}(m||(m={})),function(a){a.MODE_UNSPECIFIED="MODE_UNSPECIFIED",a.MODE_DYNAMIC="MODE_DYNAMIC"}(n||(n={}));class L extends Error{constructor(a){super(`[GoogleGenerativeAI Error]: ${a}`)}}class M extends L{constructor(a,b){super(a),this.response=b}}class N extends L{constructor(a,b,c,d){super(a),this.status=b,this.statusText=c,this.errorDetails=d}}class O extends L{}class P extends L{}!function(a){a.GENERATE_CONTENT="generateContent",a.STREAM_GENERATE_CONTENT="streamGenerateContent",a.COUNT_TOKENS="countTokens",a.EMBED_CONTENT="embedContent",a.BATCH_EMBED_CONTENTS="batchEmbedContents"}(o||(o={}));class Q{constructor(a,b,c,d,e){this.model=a,this.task=b,this.apiKey=c,this.stream=d,this.requestOptions=e}toString(){var a,b;let c=(null==(a=this.requestOptions)?void 0:a.apiVersion)||"v1beta",d=(null==(b=this.requestOptions)?void 0:b.baseUrl)||"https://generativelanguage.googleapis.com",e=`${d}/${c}/${this.model}:${this.task}`;return this.stream&&(e+="?alt=sse"),e}}async function R(a){var b;let c=new Headers;c.append("Content-Type","application/json"),c.append("x-goog-api-client",function(a){let b=[];return(null==a?void 0:a.apiClient)&&b.push(a.apiClient),b.push("genai-js/0.24.1"),b.join(" ")}(a.requestOptions)),c.append("x-goog-api-key",a.apiKey);let d=null==(b=a.requestOptions)?void 0:b.customHeaders;if(d){if(!(d instanceof Headers))try{d=new Headers(d)}catch(a){throw new O(`unable to convert customHeaders value ${JSON.stringify(d)} to Headers: ${a.message}`)}for(let[a,b]of d.entries()){if("x-goog-api-key"===a)throw new O(`Cannot set reserved header name ${a}`);if("x-goog-api-client"===a)throw new O(`Header name ${a} can only be set using the apiClient field`);c.append(a,b)}}return c}async function S(a,b,c,d,e,f){let g=new Q(a,b,c,d,f);return{url:g.toString(),fetchOptions:Object.assign(Object.assign({},function(a){let b={};if((null==a?void 0:a.signal)!==void 0||(null==a?void 0:a.timeout)>=0){let c=new AbortController;(null==a?void 0:a.timeout)>=0&&setTimeout(()=>c.abort(),a.timeout),(null==a?void 0:a.signal)&&a.signal.addEventListener("abort",()=>{c.abort()}),b.signal=c.signal}return b}(f)),{method:"POST",headers:await R(g),body:e})}}async function T(a,b,c,d,e,f={},g=fetch){let{url:h,fetchOptions:i}=await S(a,b,c,d,e,f);return U(h,i,g)}async function U(a,b,c=fetch){let d;try{d=await c(a,b)}catch(c){var e=c,f=a;let b=e;throw"AbortError"===b.name?(b=new P(`Request aborted when fetching ${f.toString()}: ${e.message}`)).stack=e.stack:e instanceof N||e instanceof O||((b=new L(`Error fetching from ${f.toString()}: ${e.message}`)).stack=e.stack),b}return d.ok||await V(d,a),d}async function V(a,b){let c,d="";try{let b=await a.json();d=b.error.message,b.error.details&&(d+=` ${JSON.stringify(b.error.details)}`,c=b.error.details)}catch(a){}throw new N(`Error fetching from ${b.toString()}: [${a.status} ${a.statusText}] ${d}`,a.status,a.statusText,c)}function W(a){return a.text=()=>{if(a.candidates&&a.candidates.length>0){if(a.candidates.length>1&&console.warn(`This response had ${a.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),Z(a.candidates[0]))throw new M(`${$(a)}`,a);return function(a){var b,c,d,e;let f=[];if(null==(c=null==(b=a.candidates)?void 0:b[0].content)?void 0:c.parts)for(let b of null==(e=null==(d=a.candidates)?void 0:d[0].content)?void 0:e.parts)b.text&&f.push(b.text),b.executableCode&&f.push("\n```"+b.executableCode.language+"\n"+b.executableCode.code+"\n```\n"),b.codeExecutionResult&&f.push("\n```\n"+b.codeExecutionResult.output+"\n```\n");return f.length>0?f.join(""):""}(a)}if(a.promptFeedback)throw new M(`Text not available. ${$(a)}`,a);return""},a.functionCall=()=>{if(a.candidates&&a.candidates.length>0){if(a.candidates.length>1&&console.warn(`This response had ${a.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),Z(a.candidates[0]))throw new M(`${$(a)}`,a);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),X(a)[0]}if(a.promptFeedback)throw new M(`Function call not available. ${$(a)}`,a)},a.functionCalls=()=>{if(a.candidates&&a.candidates.length>0){if(a.candidates.length>1&&console.warn(`This response had ${a.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),Z(a.candidates[0]))throw new M(`${$(a)}`,a);return X(a)}if(a.promptFeedback)throw new M(`Function call not available. ${$(a)}`,a)},a}function X(a){var b,c,d,e;let f=[];if(null==(c=null==(b=a.candidates)?void 0:b[0].content)?void 0:c.parts)for(let b of null==(e=null==(d=a.candidates)?void 0:d[0].content)?void 0:e.parts)b.functionCall&&f.push(b.functionCall);return f.length>0?f:void 0}let Y=[k.RECITATION,k.SAFETY,k.LANGUAGE];function Z(a){return!!a.finishReason&&Y.includes(a.finishReason)}function $(a){var b,c,d;let e="";if((!a.candidates||0===a.candidates.length)&&a.promptFeedback)e+="Response was blocked",(null==(b=a.promptFeedback)?void 0:b.blockReason)&&(e+=` due to ${a.promptFeedback.blockReason}`),(null==(c=a.promptFeedback)?void 0:c.blockReasonMessage)&&(e+=`: ${a.promptFeedback.blockReasonMessage}`);else if(null==(d=a.candidates)?void 0:d[0]){let b=a.candidates[0];Z(b)&&(e+=`Candidate was blocked due to ${b.finishReason}`,b.finishMessage&&(e+=`: ${b.finishMessage}`))}return e}function _(a){return this instanceof _?(this.v=a,this):new _(a)}"function"==typeof SuppressedError&&SuppressedError;let aa=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;async function ab(a){let b=[],c=a.getReader();for(;;){let{done:a,value:d}=await c.read();if(a)return W(function(a){let b=a[a.length-1],c={promptFeedback:null==b?void 0:b.promptFeedback};for(let b of a){if(b.candidates){let a=0;for(let d of b.candidates)if(c.candidates||(c.candidates=[]),c.candidates[a]||(c.candidates[a]={index:a}),c.candidates[a].citationMetadata=d.citationMetadata,c.candidates[a].groundingMetadata=d.groundingMetadata,c.candidates[a].finishReason=d.finishReason,c.candidates[a].finishMessage=d.finishMessage,c.candidates[a].safetyRatings=d.safetyRatings,d.content&&d.content.parts){c.candidates[a].content||(c.candidates[a].content={role:d.content.role||"user",parts:[]});let b={};for(let e of d.content.parts)e.text&&(b.text=e.text),e.functionCall&&(b.functionCall=e.functionCall),e.executableCode&&(b.executableCode=e.executableCode),e.codeExecutionResult&&(b.codeExecutionResult=e.codeExecutionResult),0===Object.keys(b).length&&(b.text=""),c.candidates[a].content.parts.push(b)}a++}b.usageMetadata&&(c.usageMetadata=b.usageMetadata)}return c}(b));b.push(d)}}async function ac(a,b,c,d){let[e,f]=(function(a){let b=a.getReader();return new ReadableStream({start(a){let c="";return function d(){return b.read().then(({value:b,done:e})=>{let f;if(e)return c.trim()?void a.error(new L("Failed to parse stream")):void a.close();let g=(c+=b).match(aa);for(;g;){try{f=JSON.parse(g[1])}catch(b){a.error(new L(`Error parsing JSON response: "${g[1]}"`));return}a.enqueue(f),g=(c=c.substring(g[0].length)).match(aa)}return d()}).catch(a=>{let b=a;throw b.stack=a.stack,b="AbortError"===b.name?new P("Request aborted when reading from the stream"):new L("Error reading from the stream")})}()}})})((await T(b,o.STREAM_GENERATE_CONTENT,a,!0,JSON.stringify(c),d)).body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0}))).tee();return{stream:function(a){return function(a,b,c){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var d,e=c.apply(a,b||[]),f=[];return d={},g("next"),g("throw"),g("return"),d[Symbol.asyncIterator]=function(){return this},d;function g(a){e[a]&&(d[a]=function(b){return new Promise(function(c,d){f.push([a,b,c,d])>1||h(a,b)})})}function h(a,b){try{var c;(c=e[a](b)).value instanceof _?Promise.resolve(c.value.v).then(i,j):k(f[0][2],c)}catch(a){k(f[0][3],a)}}function i(a){h("next",a)}function j(a){h("throw",a)}function k(a,b){a(b),f.shift(),f.length&&h(f[0][0],f[0][1])}}(this,arguments,function*(){let b=a.getReader();for(;;){let{value:a,done:c}=yield _(b.read());if(c)break;yield yield _(W(a))}})}(e),response:ab(f)}}async function ad(a,b,c,d){let e=await T(b,o.GENERATE_CONTENT,a,!1,JSON.stringify(c),d);return{response:W(await e.json())}}function ae(a){if(null!=a){if("string"==typeof a)return{role:"system",parts:[{text:a}]};if(a.text)return{role:"system",parts:[a]};if(a.parts)if(!a.role)return{role:"system",parts:a.parts};else return a}}function af(a){let b=[];if("string"==typeof a)b=[{text:a}];else for(let c of a)"string"==typeof c?b.push({text:c}):b.push(c);var c=b;let d={role:"user",parts:[]},e={role:"function",parts:[]},f=!1,g=!1;for(let a of c)"functionResponse"in a?(e.parts.push(a),g=!0):(d.parts.push(a),f=!0);if(f&&g)throw new L("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!f&&!g)throw new L("No content is provided for sending chat message.");return f?d:e}function ag(a){let b;return b=a.contents?a:{contents:[af(a)]},a.systemInstruction&&(b.systemInstruction=ae(a.systemInstruction)),b}let ah=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],ai={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function aj(a){var b;if(void 0===a.candidates||0===a.candidates.length)return!1;let c=null==(b=a.candidates[0])?void 0:b.content;if(void 0===c||void 0===c.parts||0===c.parts.length)return!1;for(let a of c.parts)if(void 0===a||0===Object.keys(a).length||void 0!==a.text&&""===a.text)return!1;return!0}let ak="SILENT_ERROR";class al{constructor(a,b,c,d={}){this.model=b,this.params=c,this._requestOptions=d,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=a,(null==c?void 0:c.history)&&(!function(a){let b=!1;for(let c of a){let{role:a,parts:d}=c;if(!b&&"user"!==a)throw new L(`First content should be with role 'user', got ${a}`);if(!K.includes(a))throw new L(`Each item should include role field. Got ${a} but valid roles are: ${JSON.stringify(K)}`);if(!Array.isArray(d))throw new L("Content should have 'parts' property with an array of Parts");if(0===d.length)throw new L("Each Content should have at least one part");let e={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(let a of d)for(let b of ah)b in a&&(e[b]+=1);let f=ai[a];for(let b of ah)if(!f.includes(b)&&e[b]>0)throw new L(`Content with role '${a}' can't contain '${b}' part`);b=!0}}(c.history),this._history=c.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(a,b={}){var c,d,e,f,g,h;let i;await this._sendPromise;let j=af(a),k={safetySettings:null==(c=this.params)?void 0:c.safetySettings,generationConfig:null==(d=this.params)?void 0:d.generationConfig,tools:null==(e=this.params)?void 0:e.tools,toolConfig:null==(f=this.params)?void 0:f.toolConfig,systemInstruction:null==(g=this.params)?void 0:g.systemInstruction,cachedContent:null==(h=this.params)?void 0:h.cachedContent,contents:[...this._history,j]},l=Object.assign(Object.assign({},this._requestOptions),b);return this._sendPromise=this._sendPromise.then(()=>ad(this._apiKey,this.model,k,l)).then(a=>{var b;if(aj(a.response)){this._history.push(j);let c=Object.assign({parts:[],role:"model"},null==(b=a.response.candidates)?void 0:b[0].content);this._history.push(c)}else{let b=$(a.response);b&&console.warn(`sendMessage() was unsuccessful. ${b}. Inspect response object for details.`)}i=a}).catch(a=>{throw this._sendPromise=Promise.resolve(),a}),await this._sendPromise,i}async sendMessageStream(a,b={}){var c,d,e,f,g,h;await this._sendPromise;let i=af(a),j={safetySettings:null==(c=this.params)?void 0:c.safetySettings,generationConfig:null==(d=this.params)?void 0:d.generationConfig,tools:null==(e=this.params)?void 0:e.tools,toolConfig:null==(f=this.params)?void 0:f.toolConfig,systemInstruction:null==(g=this.params)?void 0:g.systemInstruction,cachedContent:null==(h=this.params)?void 0:h.cachedContent,contents:[...this._history,i]},k=Object.assign(Object.assign({},this._requestOptions),b),l=ac(this._apiKey,this.model,j,k);return this._sendPromise=this._sendPromise.then(()=>l).catch(a=>{throw Error(ak)}).then(a=>a.response).then(a=>{if(aj(a)){this._history.push(i);let b=Object.assign({},a.candidates[0].content);b.role||(b.role="model"),this._history.push(b)}else{let b=$(a);b&&console.warn(`sendMessageStream() was unsuccessful. ${b}. Inspect response object for details.`)}}).catch(a=>{a.message!==ak&&console.error(a)}),l}}async function am(a,b,c,d){return(await T(b,o.COUNT_TOKENS,a,!1,JSON.stringify(c),d)).json()}async function an(a,b,c,d){return(await T(b,o.EMBED_CONTENT,a,!1,JSON.stringify(c),d)).json()}async function ao(a,b,c,d){let e=c.requests.map(a=>Object.assign(Object.assign({},a),{model:b}));return(await T(b,o.BATCH_EMBED_CONTENTS,a,!1,JSON.stringify({requests:e}),d)).json()}class ap{constructor(a,b,c={}){this.apiKey=a,this._requestOptions=c,b.model.includes("/")?this.model=b.model:this.model=`models/${b.model}`,this.generationConfig=b.generationConfig||{},this.safetySettings=b.safetySettings||[],this.tools=b.tools,this.toolConfig=b.toolConfig,this.systemInstruction=ae(b.systemInstruction),this.cachedContent=b.cachedContent}async generateContent(a,b={}){var c;let d=ag(a),e=Object.assign(Object.assign({},this._requestOptions),b);return ad(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:null==(c=this.cachedContent)?void 0:c.name},d),e)}async generateContentStream(a,b={}){var c;let d=ag(a),e=Object.assign(Object.assign({},this._requestOptions),b);return ac(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:null==(c=this.cachedContent)?void 0:c.name},d),e)}startChat(a){var b;return new al(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:null==(b=this.cachedContent)?void 0:b.name},a),this._requestOptions)}async countTokens(a,b={}){let c=function(a,b){var c;let d={model:null==b?void 0:b.model,generationConfig:null==b?void 0:b.generationConfig,safetySettings:null==b?void 0:b.safetySettings,tools:null==b?void 0:b.tools,toolConfig:null==b?void 0:b.toolConfig,systemInstruction:null==b?void 0:b.systemInstruction,cachedContent:null==(c=null==b?void 0:b.cachedContent)?void 0:c.name,contents:[]},e=null!=a.generateContentRequest;if(a.contents){if(e)throw new O("CountTokensRequest must have one of contents or generateContentRequest, not both.");d.contents=a.contents}else if(e)d=Object.assign(Object.assign({},d),a.generateContentRequest);else{let b=af(a);d.contents=[b]}return{generateContentRequest:d}}(a,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),d=Object.assign(Object.assign({},this._requestOptions),b);return am(this.apiKey,this.model,c,d)}async embedContent(a,b={}){let c="string"==typeof a||Array.isArray(a)?{content:af(a)}:a,d=Object.assign(Object.assign({},this._requestOptions),b);return an(this.apiKey,this.model,c,d)}async batchEmbedContents(a,b={}){let c=Object.assign(Object.assign({},this._requestOptions),b);return ao(this.apiKey,this.model,a,c)}}class aq{constructor(a){this.apiKey=a}getGenerativeModel(a,b){if(!a.model)throw new L("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new ap(this.apiKey,a,b)}getGenerativeModelFromCachedContent(a,b,c){if(!a.name)throw new O("Cached content must contain a `name` field.");if(!a.model)throw new O("Cached content must contain a `model` field.");for(let c of["model","systemInstruction"])if((null==b?void 0:b[c])&&a[c]&&(null==b?void 0:b[c])!==a[c]){if("model"===c&&(b.model.startsWith("models/")?b.model.replace("models/",""):b.model)===(a.model.startsWith("models/")?a.model.replace("models/",""):a.model))continue;throw new O(`Different value for "${c}" specified in modelParams (${b[c]}) and cachedContent (${a[c]})`)}let d=Object.assign(Object.assign({},b),{model:a.model,tools:a.tools,toolConfig:a.toolConfig,systemInstruction:a.systemInstruction,cachedContent:a});return new ap(this.apiKey,d,c)}}if(!process.env.GEMINI_API_KEY)throw Error("GEMINI_API_KEY is not set in environment variables");let ar=new aq(process.env.GEMINI_API_KEY),as=ar.getGenerativeModel({model:"gemini-1.5-flash"});ar.getGenerativeModel({model:"gemini-1.5-pro"});let at=`You are the 'Deep Dive Research' module of VentureForge AI.

**Task:** Conduct exhaustive, data-backed research on the selected business idea. Synthesize information and provide comprehensive market analysis.

**INPUT:**
- selected_idea: {selected_idea}

**OUTPUT FORMAT:**
Return a valid JSON object with this exact structure:
{
  "marketLandscape": {
    "totalAddressableMarket": "$X.X Billion",
    "serviceableAddressableMarket": "$X.X Million",
    "marketGrowthRate": "X% CAGR",
    "keyDrivers": ["driver1", "driver2", "driver3"]
  },
  "targetSegments": [
    {
      "segment": "Primary Target Segment",
      "size": "$XX Million",
      "characteristics": "Key demographics and behaviors",
      "painPoints": ["pain1", "pain2", "pain3"]
    }
  ],
  "competitiveLandscape": {
    "directCompetitors": [
      {
        "name": "Competitor Name",
        "strength": "Key competitive advantage",
        "weakness": "Notable limitation",
        "marketShare": "X%"
      }
    ],
    "indirectCompetitors": ["alternative1", "alternative2"],
    "competitiveGap": "Key opportunity in the market"
  },
  "keyTrends": [
    {
      "trend": "Trend Name",
      "impact": "High/Medium/Low",
      "description": "How this trend affects the market"
    }
  ],
  "technologyAnalysis": {
    "requiredTechnologies": ["tech1", "tech2", "tech3"],
    "implementationComplexity": "High/Medium/Low",
    "technologyTrends": "Relevant technological developments"
  },
  "riskFactors": [
    {
      "risk": "Risk Name",
      "severity": "High/Medium/Low",
      "mitigation": "Proposed mitigation strategy"
    }
  ]
}

**Core Principles:**
- Data-Backed & Non-Hallucinatory: Ground all analysis in realistic market data
- Professional & Analytical Tone: Maintain expertise and objectivity
- Comprehensive Coverage: Address all key aspects of market analysis
- Actionable Insights: Provide strategic implications for each finding

Conduct comprehensive research analysis now. Return ONLY the JSON object, no additional text.`;async function au(a){try{let b,c=await (0,H.getServerSession)(I.N);if(!c?.user?.email)return G.NextResponse.json({error:"Unauthorized"},{status:401});let{projectId:d,selectedIdea:e}=await a.json();if(!d||!e)return G.NextResponse.json({error:"Project ID and selected idea are required"},{status:400});let f=await J.z.user.findUnique({where:{email:c.user.email}});if(!f)return G.NextResponse.json({error:"User not found"},{status:404});if(f.credits<5)return G.NextResponse.json({error:"Insufficient credits",required:5,current:f.credits},{status:402});if(!await J.z.project.findFirst({where:{id:d,userId:f.id}}))return G.NextResponse.json({error:"Project not found"},{status:404});let g=at.replace("{selected_idea}",JSON.stringify(e)),h=`Please conduct comprehensive market research for this business idea: ${JSON.stringify(e)}

Focus on providing realistic, data-backed insights about:
1. Market size and growth potential
2. Target customer segments and their pain points
3. Competitive landscape and positioning opportunities
4. Technology requirements and implementation complexity
5. Key market trends and risk factors

Return the response as a properly formatted JSON object.`,i=(await Promise.race([as.generateContent([g,h]),new Promise((a,b)=>setTimeout(()=>b(Error("Request timeout")),28e4))])).response.text();if(!i)throw Error("No response from Gemini AI");try{let a=i.replace(/```json\n?|\n?```/g,"").trim();b=JSON.parse(a)}catch(a){console.error("JSON parsing error:",a),console.error("Raw response:",i),b={marketLandscape:{totalAddressableMarket:"Analysis in progress",serviceableAddressableMarket:"To be determined",marketGrowthRate:"Research ongoing",keyDrivers:["Market analysis in progress"]},targetSegments:[{segment:"Primary Target Segment",size:"To be determined",characteristics:i.substring(0,300)+"...",painPoints:["Analysis in progress"]}],competitiveLandscape:{directCompetitors:[],indirectCompetitors:[],competitiveGap:"Detailed analysis required"},keyTrends:[{trend:"Market Research",impact:"High",description:"Comprehensive analysis in progress"}],technologyAnalysis:{requiredTechnologies:["To be determined"],implementationComplexity:"Medium",technologyTrends:"Analysis pending"},riskFactors:[{risk:"Market Analysis",severity:"Medium",mitigation:"Detailed research required"}]}}return await J.z.$transaction([J.z.project.update({where:{id:d},data:{researchOutput:b,updatedAt:new Date}}),J.z.user.update({where:{id:f.id},data:{credits:f.credits-5}})]),G.NextResponse.json({success:!0,result:b,creditsUsed:5,creditsRemaining:f.credits-5})}catch(a){if(console.error("Error in Gemini research:",a),a instanceof Error&&"Request timeout"===a.message)return G.NextResponse.json({error:"Research request timed out. Please try again with a simpler query."},{status:408});return G.NextResponse.json({error:"Internal server error"},{status:500})}}let av=new q.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/forge/research-gemini/route",pathname:"/api/forge/research-gemini",filename:"route",bundlePath:"app/api/forge/research-gemini/route"},distDir:".next",projectDir:"",resolvedPagePath:"/Users/manojveluchuri/saas/venture-forge/src/app/api/forge/research-gemini/route.ts",nextConfigOutput:"",userland:p}),{workAsyncStorage:aw,workUnitAsyncStorage:ax,serverHooks:ay}=av;function az(){return(0,s.patchFetch)({workAsyncStorage:aw,workUnitAsyncStorage:ax})}async function aA(a,b,c){var d;let e="/api/forge/research-gemini/route";"/index"===e&&(e="/");let f=await av.prepare(a,b,{srcPage:e,multiZoneDraftMode:"false"});if(!f)return b.statusCode=400,b.end("Bad Request"),null==c.waitUntil||c.waitUntil.call(c,Promise.resolve()),null;let{buildId:g,params:h,nextConfig:i,isDraftMode:j,prerenderManifest:k,routerServerContext:l,isOnDemandRevalidate:m,revalidateOnlyGenerated:n,resolvedPathname:o}=f,p=(0,v.normalizeAppPath)(e),q=!!(k.dynamicRoutes[p]||k.routes[o]);if(q&&!j){let a=!!k.routes[o],b=k.dynamicRoutes[p];if(b&&!1===b.fallback&&!a)throw new E.NoFallbackError}let s=null;!q||av.isDev||j||(s="/index"===(s=o)?"/":s);let G=!0===av.isDev||!q,H=q&&!G,I=a.method||"GET",J=(0,u.getTracer)(),K=J.getActiveScopeSpan(),L={params:h,prerenderManifest:k,renderOpts:{experimental:{dynamicIO:!!i.experimental.dynamicIO,authInterrupts:!!i.experimental.authInterrupts},supportsDynamicResponse:G,incrementalCache:(0,t.getRequestMeta)(a,"incrementalCache"),cacheLifeProfiles:null==(d=i.experimental)?void 0:d.cacheLife,isRevalidate:H,waitUntil:c.waitUntil,onClose:a=>{b.on("close",a)},onAfterTaskError:void 0,onInstrumentationRequestError:(b,c,d)=>av.onRequestError(a,b,d,l)},sharedContext:{buildId:g}},M=new w.NodeNextRequest(a),N=new w.NodeNextResponse(b),O=x.NextRequestAdapter.fromNodeNextRequest(M,(0,x.signalFromNodeResponse)(b));try{let d=async c=>av.handle(O,L).finally(()=>{if(!c)return;c.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let d=J.getRootSpanAttributes();if(!d)return;if(d.get("next.span_type")!==y.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${d.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let e=d.get("next.route");if(e){let a=`${I} ${e}`;c.setAttributes({"next.route":e,"http.route":e,"next.span_name":a}),c.updateName(a)}else c.updateName(`${I} ${a.url}`)}),f=async f=>{var g,h;let o=async({previousCacheEntry:g})=>{try{if(!(0,t.getRequestMeta)(a,"minimalMode")&&m&&n&&!g)return b.statusCode=404,b.setHeader("x-nextjs-cache","REVALIDATED"),b.end("This page could not be found"),null;let e=await d(f);a.fetchMetrics=L.renderOpts.fetchMetrics;let h=L.renderOpts.pendingWaitUntil;h&&c.waitUntil&&(c.waitUntil(h),h=void 0);let i=L.renderOpts.collectedTags;if(!q)return await (0,A.I)(M,N,e,L.renderOpts.pendingWaitUntil),null;{let a=await e.blob(),b=(0,B.toNodeOutgoingHttpHeaders)(e.headers);i&&(b[D.NEXT_CACHE_TAGS_HEADER]=i),!b["content-type"]&&a.type&&(b["content-type"]=a.type);let c=void 0!==L.renderOpts.collectedRevalidate&&!(L.renderOpts.collectedRevalidate>=D.INFINITE_CACHE)&&L.renderOpts.collectedRevalidate,d=void 0===L.renderOpts.collectedExpire||L.renderOpts.collectedExpire>=D.INFINITE_CACHE?void 0:L.renderOpts.collectedExpire;return{value:{kind:F.CachedRouteKind.APP_ROUTE,status:e.status,body:Buffer.from(await a.arrayBuffer()),headers:b},cacheControl:{revalidate:c,expire:d}}}}catch(b){throw(null==g?void 0:g.isStale)&&await av.onRequestError(a,b,{routerKind:"App Router",routePath:e,routeType:"route",revalidateReason:(0,z.c)({isRevalidate:H,isOnDemandRevalidate:m})},l),b}},p=await av.handleResponse({req:a,nextConfig:i,cacheKey:s,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:k,isRoutePPREnabled:!1,isOnDemandRevalidate:m,revalidateOnlyGenerated:n,responseGenerator:o,waitUntil:c.waitUntil});if(!q)return null;if((null==p||null==(g=p.value)?void 0:g.kind)!==F.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==p||null==(h=p.value)?void 0:h.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});(0,t.getRequestMeta)(a,"minimalMode")||b.setHeader("x-nextjs-cache",m?"REVALIDATED":p.isMiss?"MISS":p.isStale?"STALE":"HIT"),j&&b.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let u=(0,B.fromNodeOutgoingHttpHeaders)(p.value.headers);return(0,t.getRequestMeta)(a,"minimalMode")&&q||u.delete(D.NEXT_CACHE_TAGS_HEADER),!p.cacheControl||b.getHeader("Cache-Control")||u.get("Cache-Control")||u.set("Cache-Control",(0,C.getCacheControlHeader)(p.cacheControl)),await (0,A.I)(M,N,new Response(p.value.body,{headers:u,status:p.value.status||200})),null};K?await f(K):await J.withPropagatedContext(a.headers,()=>J.trace(y.BaseServerSpan.handleRequest,{spanName:`${I} ${a.url}`,kind:u.SpanKind.SERVER,attributes:{"http.method":I,"http.target":a.url}},f))}catch(b){if(K||await av.onRequestError(a,b,{routerKind:"App Router",routePath:p,routeType:"route",revalidateReason:(0,z.c)({isRevalidate:H,isOnDemandRevalidate:m})}),q)throw b;return await (0,A.I)(M,N,new Response(null,{status:500})),null}}},44870:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:a=>{"use strict";a.exports=require("crypto")},55591:a=>{"use strict";a.exports=require("https")},63033:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:a=>{"use strict";a.exports=require("zlib")},78335:()=>{},79428:a=>{"use strict";a.exports=require("buffer")},79551:a=>{"use strict";a.exports=require("url")},81630:a=>{"use strict";a.exports=require("http")},86439:a=>{"use strict";a.exports=require("next/dist/shared/lib/no-fallback-error.external")},94735:a=>{"use strict";a.exports=require("events")},94747:(a,b,c)=>{"use strict";c.d(b,{z:()=>e});let d=require("@prisma/client"),e=globalThis.prisma??new d.PrismaClient},96487:()=>{}};var b=require("../../../../webpack-runtime.js");b.C(a);var c=b.X(0,[602,446,190],()=>b(b.s=39394));module.exports=c})();